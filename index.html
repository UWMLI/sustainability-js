<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="no-cache" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="viewport" content="width=640 initial-scale=1.0 maximum-scale=1.0 user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<title>Game</title>

<link href="style.css" rel="stylesheet" type="text/css"></link>
<script type='text/javascript' src='src/utils/webgl-utils.js'></script>
<script type="text/javascript" src="src/utils/canv.js"></script>
<script type="text/javascript" src="src/utils/inputhacks.js"></script>
<script type="text/javascript" src="src/stage.js"></script>
<script type="text/javascript" src="src/game.js"></script>
<script type="text/javascript" src="src/model.js"></script>
<script type="text/javascript" src="src/ticker.js"></script>
<script type="text/javascript" src="src/drawer.js"></script>
<script type="text/javascript" src="src/clicker.js"></script>
<script type="text/javascript" src="src/dragger.js"></script>
<script type="text/javascript" src="src/presser.js"></script>
<script type="text/javascript" src="src/flicker.js"></script>
<script type="text/javascript" src="src/assetter.js"></script>
<script type="text/javascript" src="src/scenes/nullScene.js"></script>
<script type="text/javascript" src="src/scenes/loadingScene.js"></script>
<!--<script type="text/javascript" src="src/scenes/gameplayScene.js"></script>--><!--Just acts as example for scene- not actually used.-->
<script type="text/javascript" src="src/scenes/sweater/sweaterScene.js"></script>
<script type="text/javascript" src="src/scenes/barrel/barrelScene.js"></script>
<script type="text/javascript" src="src/scenes/wheel/wheelScene.js"></script>
<script type="text/javascript" src="src/scenes/bulb/bulbScene.js"></script>
<script type="text/javascript" src="src/scenes/window/windowScene.js"></script>
<script type="text/javascript" src="src/scenes/pavement/pavementScene.js"></script>
<script type="text/javascript">
    //window.onerror = function(msg, url, linenumber) { console.log('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber); return true; };

    var m;//model
    var g;//game

    //Prepare and load HTML+JS
    var ARIS = {};
    var readyCount = 2;
    function partReady() { readyCount--; if(readyCount == 0) stackLoaded(); }
    ARIS.ready = function() { partReady(); };
    window.addEventListener('load', partReady, false);
    //Sync with ARIS for data
    function stackLoaded()
    {
      window.scrollTo(0,1);
      m = new Model();
      m.fetchSync(function(){
        switch(m.gameType)
        {
          case "sweater":  g = new Game(SweaterScene);  break;
          case "barrel":   g = new Game(BarrelScene);   break;
          case "wheel":    g = new Game(WheelScene);    break;
          case "bulb":     g = new Game(BulbScene);     break;
          case "window":   g = new Game(WindowScene);   break;
          case "pavement": g = new Game(PavementScene); break;
          default:         g = new Game(SweaterScene);  break;
        }
        hackInputs(); //ugh (note- must wait til after game creation)
        g.begin();
      });
    }

    //Uncomment to test on PC
    ///*
    ARIS.parseURLParams = function(url)
    { 
      var gameType = "";
      var vars = window.location.search.substring(1).split("&");
      for (var i=0;i<vars.length;i++) { var pair = vars[i].split("="); if(pair[0] == "game") gameType = pair[1]; } 
      return {"gameId":0,"playerId":0,"webPageId":0,"gameType":gameType};
    };
    ARIS.getItemCount = function(itemId){ ARIS.didUpdateItemQty(itemId, 1); };
    ARIS.ready();
    //*/
</script>
</head>

<body id='dabody' class='full_screen' style='position:fixed;'>
  <div id='stage_container' class='full_screen'></div>
  <div id='debug' class='full_screen' style='position:absolute; top:0px; left:0px; color:white; pointer-events:none;'></div>
</body>

</html>

