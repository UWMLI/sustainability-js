<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="no-cache" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="viewport" content="width=640 initial-scale=1.0 maximum-scale=1.0 user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<title>Game</title>
<script type='text/javascript' src='src/config.js'></script>
<script type='text/javascript' src='src/utils/js_hacks.js'></script>
<script type='text/javascript' src='src/utils/webgl-utils.js'></script>
<script type="text/javascript" src="src/canv.js"></script>
<script type="text/javascript" src="src/stage.js"></script>
<script type="text/javascript" src="src/game.js"></script>
<script type="text/javascript" src="src/model.js"></script>

<script type="text/javascript" src="src/doqueues/assetter.js"></script>
<script type="text/javascript" src="src/doqueues/clicker.js"></script>
<script type="text/javascript" src="src/doqueues/debugger.js"></script>
<script type="text/javascript" src="src/doqueues/dragger.js"></script>
<script type="text/javascript" src="src/doqueues/drawer.js"></script>
<script type="text/javascript" src="src/doqueues/flicker.js"></script>
<script type="text/javascript" src="src/doqueues/hoverer.js"></script>
<script type="text/javascript" src="src/doqueues/presser.js"></script>
<script type="text/javascript" src="src/doqueues/ticker.js"></script>

<script type="text/javascript" src="src/scenes/nullScene.js"></script>
<script type="text/javascript" src="src/scenes/loadingScene.js"></script>
<script type="text/javascript" src="src/scenes/sweaterScene.js"></script>
<script type="text/javascript" src="src/scenes/barrelScene.js"></script>
<script type="text/javascript" src="src/scenes/wheelScene.js"></script>
<script type="text/javascript" src="src/scenes/bulbScene.js"></script>
<script type="text/javascript" src="src/scenes/windowScene.js"></script>
<script type="text/javascript" src="src/scenes/pavementScene.js"></script>
<script type="text/javascript" src="src/scenes/bikeScene.js"></script>

<script type="text/javascript">
var m; //model
var g; //game

//Prepare and load HTML+JS
var ARIS = {};
var readyCount = 2;
function partReady() { readyCount--; if(readyCount == 0) stackLoaded(); }
ARIS.ready = function() { partReady(); };
window.addEventListener('load', partReady, false);

//Sync with ARIS for data
function stackLoaded()
{
  window.scrollTo(0,1);
  m = new Model();
  m.fetchSync(function()
  {
    var actualWidthOfStuff = window.innerWidth;
    var actualHeightOfStuff = window.innerHeight;
    if(platform == "PC")
    {
      //just force it to "fake" phone size rather than adapting to browser
      actualWidthOfStuff = 640;
      actualHeightOfStuff = 1008;
    }
    document.body.style.width  = actualWidthOfStuff+"px";
    document.body.style.height = actualHeightOfStuff+"px";
    document.getElementById("content").style.width = actualWidthOfStuff+"px";
    document.getElementById("content").style.height = actualHeightOfStuff+"px";
    document.getElementById("debug_div").style.width = actualWidthOfStuff+"px";
    document.getElementById("debug_div").style.height = actualHeightOfStuff+"px";
    document.getElementById("stage_container").style.width = actualWidthOfStuff+"px";
    document.getElementById("stage_container").style.height = actualHeightOfStuff+"px";

    g = new Game(
    {
      width:actualWidthOfStuff,
      height:actualHeightOfStuff,
      physical_width:actualWidthOfStuff,   //the size displayed on screen
      physical_height:actualHeightOfStuff, //the size displayed on screen
      theoretical_width:640,  //the size referenced within game
      theoretical_height:1008,//the size referenced within game
      container:"stage_container"
    });

    switch(m.gameType)
    {
      case "sweater":  g.setMainScene(SweaterScene);  break;
      case "barrel":   g.setMainScene(BarrelScene);   break;
      case "wheel":    g.setMainScene(WheelScene);    break;
      case "bulb":     g.setMainScene(BulbScene);     break;
      case "window":   g.setMainScene(WindowScene);   break;
      case "pavement": g.setMainScene(PavementScene); break;
      case "bike":     g.setMainScene(BikeScene);     break;
      default:         g.setMainScene(WindowScene);   break;
    }
    g.begin();
  });
}

//Simulates injection of ARISjs- Uncomment to test outside ARIS
///*
ARIS.parseURLParams = function(url)
{
  var gameType = "";
  var vars = window.location.search.substring(1).split("&");
  for (var i=0;i<vars.length;i++)
  {
    var pair = vars[i].split("=");
    if(pair[0].toLowerCase() == "gameType".toLowerCase()) gameType = pair[1].replace('/','').toLowerCase();
    if(pair[0].toLowerCase() == "platform".toLowerCase()) platform = pair[1].replace('/','').toUpperCase(); //part of config
    if(pair[0].toLowerCase() == "debug".toLowerCase()) debug = (pair[1].replace('/','').toLowerCase() == "true"); //part of config
  }
  return {"gameId":0,"playerId":0,"webPageId":0,"gameType":gameType};
};
ARIS.getItemCount = function(itemId){ ARIS.didUpdateItemQty(itemId, 1); };
ARIS.ready();
//*/

window.addEventListener('touchstart', function(e){ e.preventDefault() }); //prevent browser from doing anything funny
</script>

<style>
.do
{
  display:block;
  position:absolute;
  top:0px;
  left:0px;
  margin:0px;
  padding:0px;
  user-select:none;
}
.noselect {
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  -khtml-user-select:none;
  -moz-user-select:none;
  -ms-user-select:none;
  user-select:none;
}
</style>

</head>
<body class="do noselect">

<div id="content" class="do">
  <div id="debug_div" class="do" style="pointer-events:none;"> </div>
  <div id="stage_container" class="do"> </div>
</div>

</body>
</html>

